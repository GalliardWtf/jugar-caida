<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unirse a Ca铆da Venezolana</title>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        p {
            color: #aaaaaa;
            margin-bottom: 30px;
        }
        .btn {
            background-color: #25D366;
            color: white;
            padding: 18px 40px;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
            transition: transform 0.2s;
        }
        .btn:active {
            transform: scale(0.95);
        }
        .loader {
            border: 4px solid #333;
            border-top: 4px solid #25D366;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="loader"></div>
    
    <h2 id="tituloMensaje"> Abriendo el juego...</h2>
    <p>Si la aplicaci贸n no se abre autom谩ticamente, toca el bot贸n:</p>
    
    <a id="botonEntrar" href="#" class="btn">Entrar a la Sala</a>

    <script>
        // 1. Leer par谩metros de la URL (?lobby=...&name=...)
        const params = new URLSearchParams(window.location.search);
        const lobbyId = params.get('lobby');
        const nameBase64 = params.get('name'); 

        if (lobbyId) {
            // 2. Construir el Deep Link (caida://)
            // IMPORTANTE: nameBase64 ya viene listo para pasarse, no lo tocamos
            let deepLink = "caida://unirse?lobby=" + lobbyId;
            
            if (nameBase64) {
                // Lo volvemos a codificar solo para asegurar que pase intacto por la URL interna
                deepLink += "&name=" + encodeURIComponent(nameBase64);
            }

            document.getElementById("botonEntrar").href = deepLink;

            // 3. Mostrar el Nombre Real en la Web (Decodificar para el usuario)
            if (nameBase64) {
                try {
                    // atob() convierte Base64 a texto
                    const decodedString = window.atob(nameBase64);
                    // decodeURIComponent(escape()) arregla acentos y emojis
                    const nombreReal = decodeURIComponent(escape(decodedString));
                    
                    document.getElementById("tituloMensaje").innerText = " " + nombreReal + " te invita a jugar";
                } catch (e) {
                    console.error("Error decodificando nombre en web:", e);
                }
            }

            // 4. Redirecci贸n Autom谩tica
            setTimeout(function() {
                window.location.href = deepLink;
            }, 500);

        } else {
            // Error: Link roto
            document.querySelector(".loader").style.display = "none";
            document.getElementById("tituloMensaje").innerText = "锔 Enlace incompleto";
            document.querySelector("p").innerText = "El enlace no tiene c贸digo de sala.";
            document.getElementById("botonEntrar").style.display = "none";
        }
    </script>
</body>
</html>
